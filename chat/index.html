<!doctype html>
<html>
<head>
   <title>Math Class Chat</title>
   <meta http-equiv=content-type content=text/html;charset=utf-8>
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <meta name=apple-mobile-web-app-capable content=yes>  
   <meta name=apple-mobile-web-app-status-bar-style content=black>

   <link rel=apple-touch-icon href=icon.png>
   <link rel=apple-touch-startup-image href=startup.png>
   <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />

   <style>
       .message {
           padding: 5px 5px 5px 5px;
       }
       .username {
           font-weight: strong;
           color: #011000;
       }
       .msgContainerDiv {
           overflow-y: scroll;
           height: 300px;
       }
   </style>
</head>
<body>
    <script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
    <script src="http://cdn.pubnub.com/pubnub-3.13.0.min.js"></script>

   <div data-role="page" id="chatPage" data-role="page" data-theme="b">

       <div data-role="header" data-theme="b">
           <h1>Math Class Chat ;)</h1>
       </div>

       <div data-role="content">
       <div id="incomingMessages" name="incomingMessages" class="msgContainerDiv" ></div>
       <label for="messageText"><strong>Message:</strong></label>
       

       <fieldset class="ui-grid-a">
           <div class="ui-block-a"><textarea id="messageText"></textarea></div>
           <div class="ui-block-c"><button data-theme="b" id="chatSendButton" name="chatSendButton">Send</input>
       </fieldset>
       </div>

   </div>



   <script>$(document).ready(function(){

        var role = location.search.split('role=')[1];
        var chatName = "Math chat";
        var channel  = "math_chat";
    

        pubnub = PUBNUB({                          
            publish_key   : 'pub-c-fc26f3bd-29d8-41bf-8321-62e232e89b95',
            subscribe_key : 'sub-c-1bcd79be-ddb0-11e5-a046-0619f8945a4f'
    })

       pubnub.subscribe({
           channel  : channel,
           callback : function(message) {
               $("#incomingMessages").append(
                   "<div class='message'><span class='username'>" +
                   (role || 'Anonymous') +
                   "</span> : " +
                   (message.text || ' ') +
                   "</div>"
               );
               $("#incomingMessages").scrollTop(
                   $("#incomingMessages")[0].scrollHeight
               );
           }
       });


       $("#messageText").bind( 'keydown', function(e) {
           if ((e.keyCode || e.charCode) !== 13) return true;
           $("#chatSendButton").click();
           return false;
       });

       $("#chatSendButton").click(function(){
           pubnub.publish({
               channel : channel,
               message : {
                    chatName : chatName,
                    text     : $("#messageText").val()
                }
           });
           $("#messageText").val("");
       });

   });</script>
</body>
</html>