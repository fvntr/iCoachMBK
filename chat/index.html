<!doctype html>
<html>
<head>
   <title>Math Class Chat</title>
   <meta http-equiv=content-type content=text/html;charset=utf-8>
   <meta name="viewport" content="width=device-width, initial-scale=1">

   <meta name=apple-mobile-web-app-capable content=yes>  
   <meta name=apple-mobile-web-app-status-bar-style content=black>

   <link rel=apple-touch-icon href=icon.png>
   <link rel=apple-touch-startup-image href=startup.png>
   <link rel="stylesheet" href="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.css" />

   <style>
       .message {
           padding: 5px 5px 5px 5px;
       }
       .username {
           /*font-weight: strong;*/
           color: #011000;
       }
       .msgContainerDiv {
           overflow-y: scroll;
           height: 300px;
       }

       .floating-box {
            display: inline-block;
        }
   </style>
</head>
<body>
    <script src="http://code.jquery.com/jquery-1.6.4.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.0/jquery.mobile-1.0.min.js"></script>
    <script src="http://cdn.pubnub.com/pubnub-3.13.0.min.js"></script>

   <div data-role="page" id="chatPage" data-role="page">

      <div data-role="header">
          <div id="studentName">
           <span id="studentName">JACOB</span>
          </div>
          <div id="studentInfoSection">
              <div id="studentPhoto">
                <img src="images/head_shots/student_headshot.jpeg">
                
              </div>
              <div id="studentActivities">
                <div id="gpaSection">
                      <span id="gpaAverage"> 4.0 </span>
                      <span id="gpaTitle"> GPA</span>
                </div>
                <div id="classSection">
                      <span id="numClasses"> 6.0 </span>
                      <span id="classesTitle"> Classes</span>
                </div>
              </div>
          </div>
       </div>

       <div data-role="content">
       <div id="incomingMessages" name="incomingMessages" class="msgContainerDiv" ></div>
       <label for="messageText"><strong>Message:</strong></label>
       

       <fieldset class="ui-grid-a">
           <div class="ui-block-a"><textarea id="messageText"></textarea></div>
           <div class="ui-block-c"><button data-theme="b" id="chatSendButton" name="chatSendButton">Send</div>
       </fieldset>
       </div>

   </div>



   <script>$(document).ready(function(){

        var role = location.search.split('role=')[1];
        var chatName = "Math chat";
        var channel  = "math_chat";
        var gpa = 3.5
    

        pubnub = PUBNUB({                          
            publish_key   : 'pub-c-fc26f3bd-29d8-41bf-8321-62e232e89b95',
            subscribe_key : 'sub-c-1bcd79be-ddb0-11e5-a046-0619f8945a4f'
        })

        pubnub.subscribe({
           channel  : channel,
           callback : function(message) {
                if (message.text.indexOf("grade") ==-1){
                    $("#incomingMessages").append(
                       "<div class='message'><span class='username'>" +
                       (message.username || 'Anonymous') +
                       "</span> : " +
                       (message.text || ' ') +
                       "</div>"
                    );
                    $("#incomingMessages").scrollTop(
                        $("#incomingMessages")[0].scrollHeight
                    );
                }else{
                    grade = message.text.replace('grade', '')
                    $("#incomingMessages").append(
                       "<div class='message'><span class='username'>" +
                       ('Bot') +
                       "</span> : " +
                       ('The grade of your last assignment is '+grade+' and your GPA is updated now') +
                       "</div>"
                    );

                    $("#gpa").append(( ($("#gpa").val() / 10) + grade ) * 11);
                    $("#incomingMessages").scrollTop(
                        $("#incomingMessages")[0].scrollHeight
                    );
                }
           }
       });


       $("#messageText").bind( 'keydown', function(e) {
           if ((e.keyCode || e.charCode) !== 13) return true;
           $("#chatSendButton").click();
           return false;
       });

       $("#chatSendButton").click(function(){
           pubnub.publish({
               channel : channel,
               message : {
                    username : role,
                    text     : $("#messageText").val()
                }
           });
           $("#messageText").val("");
       });

   });</script>
</body>
</html>